title: Marktstammdatenregister
source: Marktstammdatenregister
source_url: https://www.marktstammdatenregister.de/MaStR/Datendownload
about: Marktstammdatenregister.dev
about_url: https://marktstammdatenregister.dev
plugins:
    datasette-cluster-map:
        latitude_column: Breitengrad
        longitude_column: Laengengrad
databases:
    Marktstammdatenregister:
        description_html: |
            <details>
                <summary>Was ist das Marktstammdatenregister?</summary>
                <p>Das <a href="https://www.marktstammdatenregister.de">Marktstammdatenregister</a> ist das Register für den deutschen Strom- und Gasmarkt. Es wird von der Bundesnetzagentur geführt.</p>
            </details>
            <details>
                <summary>Was bedeuten die Tabellen und Spalten?</summary>
                <p>Die Tabellen und Spalten sind in der <a href="https://www.marktstammdatenregister.de/MaStRHilfe/files/gesamtdatenexport/Dokumentation%20MaStR%20Gesamtdatenexport.pdf">Dokumentation</a> beschrieben.
            </details>
        tables:
            Katalogkategorie:
                label_column: Name
                # Datasette >0.58.1 fails if 'hidden: true' is set.
                #hidden: true
            Katalogwert:
                label_column: Wert
                # Datasette >0.58.1 fails if 'hidden: true' is set.
                #hidden: true
            sqlite_stat1:
                hidden: true
        queries:
            NachNettonennleistung:
                title: Photovoltaikanlagen im gegebenen Ort, sortiert nach Nettonennleistung
                hide_sql: true
                sql: |-
                    select
                      Nettonennleistung,
                      Bruttoleistung,
                      AnzahlModule,
                      Firmenname,
                      NameStromerzeugungseinheit,
                      Inbetriebnahmedatum,
                      EinheitSystemstatus,
                      EinheitBetriebsstatus,
                      EinheitMastrNummer,
                      AnlagenbetreiberMastrNummer,
                      EegMaStRNummer,
                      Laengengrad as longitude,
                      Breitengrad as latitude
                    from
                      EinheitSolar e
                      join Marktakteur m on e.AnlagenbetreiberMastrNummer = m.MastrNummer
                    where
                      e.Ort = :Ort
                      and e.EinheitSystemstatus = 472
                      and e.EinheitBetriebsstatus = 35
                    order by
                      e.Nettonennleistung desc
            SolarMonatlichGesamt:
                title: Monatliche Entwicklung der Nettonennleistung (Solar) in ganz Deutschland
                hide_sql: true
                sql: |-
                    with per_month_started as (
                      select
                        substr(Inbetriebnahmedatum, 0, 8) as Monat,
                        sum(Nettonennleistung) as Leistung
                      from
                        EinheitSolar
                      where
                        Inbetriebnahmedatum != ''
                      group by
                        Monat
                    ),
                    per_month_retired as (
                      select
                        substr(DatumEndgueltigeStilllegung, 0, 8) as Monat,
                        sum(Nettonennleistung) as Leistung
                      from
                        EinheitSolar
                      where
                        DatumEndgueltigeStilllegung != ''
                      group by
                        Monat
                    ),
                    months as (
                      select
                        Monat
                      from
                        per_month_started
                      union
                      select
                        Monat
                      from
                        per_month_retired
                    ),
                    per_month_cumulative as (
                      select
                        m.Monat,
                        sum(s.Leistung - r.Leistung) over (
                          order by
                            m.Monat
                        ) as Leistung,
                        s.Leistung as Leistung_neuInBetrieb,
                        r.Leistung as Leistung_stillgelegt
                      from
                        months m
                        left join per_month_started s on (m.Monat = s.Monat)
                        left join per_month_retired r on (m.Monat = r.Monat)
                    )
                    select
                      *
                    from
                      per_month_cumulative
                    where
                      Monat > '2010-00';
            WindMonatlichGesamt:
                title: Monatliche Entwicklung der Nettonennleistung (Wind) in ganz Deutschland
                hide_sql: true
                sql: |-
                    with per_month_started as (
                      select
                        substr(Inbetriebnahmedatum, 0, 8) as Monat,
                        sum(Nettonennleistung) as Leistung
                      from
                        EinheitWind
                      where
                        Inbetriebnahmedatum != ''
                      group by
                        substr(Inbetriebnahmedatum, 0, 8)
                    ),
                    per_month_retired as (
                      select
                        substr(DatumEndgueltigeStilllegung, 0, 8) as Monat,
                        sum(Nettonennleistung) as Leistung
                      from
                        EinheitWind
                      where
                        DatumEndgueltigeStilllegung != ''
                      group by
                        substr(DatumEndgueltigeStilllegung, 0, 8)
                    ),
                    months as (
                      select
                        Monat
                      from
                        per_month_started
                      union
                      select
                        Monat
                      from
                        per_month_retired
                    ),
                    per_month_cumulative as (
                      select
                        m.Monat,
                        sum(s.Leistung - r.Leistung) over (
                          order by
                            m.Monat
                        ) as Leistung,
                        s.Leistung as Leistung_neuInBetrieb,
                        r.Leistung as Leistung_stillgelegt
                      from
                        months m
                        left join per_month_started s on (m.Monat = s.Monat)
                        left join per_month_retired r on (m.Monat = r.Monat)
                    )
                    select
                      *
                    from
                      per_month_cumulative
                    where
                      Monat > '2010-00';
            BuergerenergieNachLeistung:
                title: Bürgerenergie nach Gesamtleistung
                hide_sql: true
                sql: |-
                    select
                      cast(sum(Nettonennleistung) as integer) as Leistung,
                      m.Ort,
                      m.Firmenname,
                      m.Taetigkeitsbeginn,
                      count(e.EinheitMastrNummer) as AnzahlEinheit,
                      m.MastrNummer
                    from
                      Marktakteur m
                      left join EinheitSolar e on e.AnlagenbetreiberMastrNummer = m.MastrNummer
                    where
                      m.Firmenname like "%bürger%"
                      and m.Firmenname not like "%bürgerlich%"
                    group by
                      m.MastrNummer
                    order by
                      Leistung desc
